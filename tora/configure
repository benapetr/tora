#!/bin/sh
############################################################################
# $Id$
#
# Copyright (C) 2000-2001 GlobeCom AB.  All rights reserved.
#
# This file is part of the Toolkit for Oracle.
#
# This file may be distributed under the terms of the Q Public License
# as defined by Trolltech AS of Norway and appearing in the file
# LICENSE included in the packaging of this file.
#
# This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
# WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
#
# See http://www.globecom.net/tora/ for more information.
#
# Contact tora@globecom.se if any conditions of this licensing are
# not clear to you.
#
############################################################################

echo Trying to configure TOra

PERL=`which perl`

if [ -z $PERL ]
then
	echo PERL Required for installation
fi

$PERL configure.pl $1 $2 $3 $4 $5 $6 $7 $8 $9

if [ $? != 0 ]
then
    echo configure.pl failed. Exiting.
    exit 2
fi

# Get the MOC stuff

egrep "^(UIC)|(MOC)" Makefile.setup > configure.setup

. ./configure.setup

echo Compiling designer files
for a in *.ui
do
    base=`echo $a | sed 's/\.[^\.]*$//'`
    $UIC -o $base.h $a
    $UIC -i $base.h -o $base.cpp $a
done

echo Metacompiling moc files
for a in *.h qtlegacy/*.h
do
    if grep -i Q_OBJECT $a >/dev/null
    then
	$MOC -o `echo $a | sed 's/\.h$/\.moc/'` $a
    fi
done

echo Generating empty dependfiles
if [ \! -d .depends ]
then
    mkdir .depends
fi
for a in *.cpp
do
    b=.depends/`echo $a | sed 's/\.cpp$/\.d/'`
    true > $b
    touch -t 7312210000 $b
done

if [ -f Makefile.orig ]
then
    cp Makefile.orig Makefile
fi

echo "static char *LicenseText=\"<PRE>\\n\"" > LICENSE.h
$PERL -e 'while(<>) { chomp; s/\\/\\\\/; s/\"/\\\"/g; print "\"$_\\n\"\n"; }' < LICENSE >> LICENSE.h
echo "\"</PRE>\\n\";" >> LICENSE.h

echo
echo "If you have any problems check the Makefile.setup for the settings."
