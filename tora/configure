#!/bin/sh
############################################################################
#
# TOra - An Oracle Toolkit for DBA's and developers
# Copyright (C) 2003 Quest Software, Inc
# 
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation;  only version 2 of
# the License is valid for this program.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
#
#      As a special exception, you have permission to link this program
#      with the Oracle Client libraries and distribute executables, as long
#      as you follow the requirements of the GNU GPL in regard to all of the
#      software in the executable aside from Oracle client libraries.
#
#      Specifically you are not permitted to link this program with the
#      Qt/UNIX, Qt/Windows or Qt Non Commercial products of TrollTech.
#      And you are not permitted to distribute binaries compiled against
#      these libraries without written consent from Quest Software, Inc.
#      Observe that this does not disallow linking to the Qt Free Edition.
#
# All trademarks belong to their respective owners.
#
############################################################################

if (echo "testing\c"; echo 1,2,3) | grep c >/dev/null; then
  # Stardent Vistra SVR4 grep lacks -e, says ghazi@caip.rutgers.edu.
  if (echo -n testing; echo 1,2,3) | sed s/-n/xn/ | grep xn >/dev/null; then
    ac_n= ac_c='
' ac_t='	'
  else
    ac_n=-n ac_c= ac_t=
  fi
else
  ac_n= ac_c='\c' ac_t=
fi

echo $ac_n "checking for perl...$ac_c"

if (perl -v | grep -i "v[^0-9]*5") > /dev/null 2>/dev/null
then
    PERL=perl
fi

if [ "X$PERL" = "X" ]
then
        PERL=`which perl`
fi

if [ "X$PERL" = "X" ]
then
	echo 'failed!'
        echo
        echo PERL Required for installation
	echo
	echo "If you don't have perl in your path set the PERL environment variable"
	echo "to point to your perl binary."
	exit;
fi

echo " $PERL"

$PERL configure.pl tora tora $*
if [ $? != 0 ]
then
   exit 2
fi

# Get the MOC/UIC stuff

egrep "^(UIC|MOC)" Makefile | $PERL -p -e 's/\$\(QTDIR\)/\$QTDIR/g' > configure.setup

. ./configure.setup
rm -f configure.setup

echo $ac_n "creating designer files $ac_c"
for a in *.ui license/*ui
do
    base=`echo $a | sed 's/\.[^\.]*$//'`
    echo $ac_n ".$ac_c"
    $UIC -o $base.h $a
    $UIC -i $base.h -o $base.cpp $a
done
echo " done"

echo $ac_n "creating moc files ... $ac_c"
for a in *.h qtlegacy/*.h license/*.h
do
    if grep -i Q_OBJECT $a >/dev/null
    then
	$MOC -o `echo $a | sed 's/\.h$/\.moc/'` $a
    fi
done
echo done

echo $ac_n "creating empty dependfiles ... $ac_c"
if [ \! -d .depends ]
then
    mkdir .depends
fi
for a in *.cpp
do
    b=.depends/`echo $a | sed 's/\.cpp$/\.d/'`
    true > $b
    touch -t 7312210000 $b
done

echo "done"

echo $ac_n "removing leftover intermediate files ... $ac_c"
rm -rf objs 2> /dev/null
echo "done"

echo 'static char *LicenseText="<PRE>"' > LICENSE.h
$PERL -e 'while(<>) { chomp; s/\\/\\\\/; s/\"/\\\"/g; print "\"$_\\n\"\n"; }' < LICENSE.txt >> LICENSE.h
echo '"</PRE>";' >> LICENSE.h

echo
echo "------------------------------------------------------------------------"
echo
echo "You must use a GNU version of make to compile this program."
echo
echo "If you have any problems check the top of the Makefile for the settings."
echo
echo "                                                          Henrik Johnson"
echo "                                                     Quest Software, Inc"
echo "------------------------------------------------------------------------"
