#!/bin/sh
############################################################################
#
# TOra - An Oracle Toolkit for DBA's and developers
# Copyright (C) 2000-2001,2001 Underscore AB
# 
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation;  only version 2 of
# the License is valid for this program.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
#
#      As a special exception, you have permission to link this program
#      with the Oracle Client libraries and distribute executables, as long
#      as you follow the requirements of the GNU GPL in regard to all of the
#      software in the executable aside from Oracle client libraries.
#
#      Specifically you are not permitted to link this program with the
#      Qt/UNIX, Qt/Windows or Qt Non Commercial products of TrollTech.
#      And you are not permitted to distribute binaries compiled against
#      these libraries without written consent from Underscore AB. Observe
#      that this does not disallow linking to the Qt Free Edition.
#
# All trademarks belong to their respective owners.
#
############################################################################

echo Trying to configure TOra

echo Trying to configure TOra

if (perl -v | grep -i "v[^0-9]*5") > /dev/null 2>/dev/null
then
    PERL=perl
fi

if [ "X$PERL" = "X" ]
then
        PERL=`which perl`
fi

if [ "X$PERL" = "X" ]
then
	echo PERL Required for installation
	echo
	echo "If you don't have perl in your path set the PERL environment variable"
	echo "to point to your perl binary."
	exit;
fi

$PERL configure.pl $1 $2 $3 $4 $5 $6 $7 $8 $9

if [ $? != 0 ]
then
    echo configure.pl failed. Exiting.
    exit 2
fi

# Get the MOC stuff

egrep "^(UIC)|(MOC)" Makefile.setup > configure.setup

. ./configure.setup
rm -f configure.setup

echo Compiling designer files
for a in *.ui
do
    base=`echo $a | sed 's/\.[^\.]*$//'`
    $UIC -o $base.h $a
    $UIC -i $base.h -o $base.cpp $a
done

echo Metacompiling moc files
for a in *.h qtlegacy/*.h
do
    if grep -i Q_OBJECT $a >/dev/null
    then
	$MOC -o `echo $a | sed 's/\.h$/\.moc/'` $a
    fi
done

echo Generating empty dependfiles
if [ \! -d .depends ]
then
    mkdir .depends
fi
for a in *.cpp
do
    b=.depends/`echo $a | sed 's/\.cpp$/\.d/'`
    true > $b
    touch -t 7312210000 $b
done

echo 'static char *LicenseText="<PRE>\n"' > LICENSE.h
$PERL -e 'while(<>) { chomp; s/\\/\\\\/; s/\"/\\\"/g; print "\"$_\\n\"\n"; }' < LICENSE >> LICENSE.h
echo '"</PRE>\n";' >> LICENSE.h

echo
echo "You must use a GNU version of make to compile this program."
echo
echo "If you have any problems check the Makefile.setup for the settings."
